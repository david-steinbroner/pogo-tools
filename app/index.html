<!DOCTYPE html>
<!-- v3-refactor: Cloudflare Pages deployment trigger -->
<html lang="en" data-skin="gba-ds">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>PoGO Pal</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&family=Outfit:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<link rel="stylesheet" href="./styles/app.css">
</head>
<body>

<div class="app">
<!-- APP BAR -->
<header id="appBar" class="appbar">
  <div class="appbar-left">
    <div class="title">PoGO Pal</div>
  </div>
  <div class="appbar-right">
    <input accept=".csv" class="hidden-file" id="fileInput" type="file"/>
    <button id="uploadBtn" class="icon-btn" type="button" aria-label="Upload CSV" title="Upload CSV">
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M19 15v4H5v-4H3v6h18v-6h-2zM11 17V8.83l-2.59 2.58L7 10l5-5 5 5-1.41 1.41L13 8.83V17h-2z"></path>
      </svg>
    </button>
    <button id="infoBtn" class="icon-btn gbp-q" type="button" aria-label="Info" title="Glossary">?</button>
  </div>
</header>

<main class="main">
  <div class="app-window">
    <!-- Window Tabs -->
    <div class="window-tabs" role="tablist" aria-label="Mode">
      <button id="modeVsBtn" class="window-tab is-active" role="tab" aria-selected="true" type="button">Versus</button>
      <button id="modeCollectionBtn" class="window-tab" role="tab" aria-selected="false" type="button">Collection</button>
      <button id="modeTradeBtn" class="window-tab" role="tab" aria-selected="false" type="button">Trade</button>
    </div>

    <!-- Window Content -->
    <div class="window-content">
      <!-- VIEW: VERSUS -->
      <div id="viewVersus">
    <section id="vsView" class="vs-view">
      <div class="vs-panel">
        <div class="vs-panel-header">
          <div class="panel-subtitle mono" id="vsSub">
            Pick opponent type(s). We'll show you how to increase your chances at winning.
            <button class="info-icon-btn" id="vsInfoBtn" type="button" aria-label="More info">i</button>
          </div>
        </div>

        <div class="vs-block">
          <div class="battle-selected-wrap" aria-label="Selected opponent types">
            <div class="battle-selected" id="vsSelected"></div>
          </div>

          <details class="vs-details" id="vsTypePicker" open>
            <summary class="vs-summary" hidden></summary>
            <div class="type-grid" id="vsTypeGrid" aria-label="Opponent type grid"></div>
          </details>

          <div class="vs-actions">
            <button class="sheet-btn ghost" id="vsClearBtn" type="button">Clear</button>
            <button class="sheet-btn" id="vsDoneBtn" type="button">Done</button>
          </div>
        </div>

        <div class="panel-section-header" id="vsRecoHeader" hidden>
          <div class="panel-subtitle mono">Your POGO PAL recommends these moves and pokemon types.</div>
        </div>

        <div class="vs-hero" id="vsHero" hidden>
          <div class="vs-hero-grid">
            <div class="vs-hero-card">
              <div class="vs-h">Top picks</div>
              <div class="vs-picks" id="vsTopPicks"></div>
              <div class="vs-empty" id="vsTopEmpty">
                <span class="mono">Upload a CSV to see roster picks.</span>
                <button class="icon-btn vs-empty-upload" id="vsTopUploadBtn" type="button" aria-label="Upload CSV" title="Upload CSV">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M19 15v4H5v-4H3v6h18v-6h-2zM11 17V8.83l-2.59 2.58L7 10l5-5 5 5-1.41 1.41L13 8.83V17h-2z"></path>
                  </svg>
                </button>
              </div>
            </div>

            <div class="vs-hero-card">
              <div class="vs-h">Risky picks</div>
              <div class="vs-picks" id="vsRiskyPicks"></div>
              <div class="vs-empty" id="vsRiskyEmpty">
                <span class="mono">Upload a CSV to see roster picks.</span>
                <button class="icon-btn vs-empty-upload" id="vsRiskyUploadBtn" type="button" aria-label="Upload CSV" title="Upload CSV">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M19 15v4H5v-4H3v6h18v-6h-2zM11 17V8.83l-2.59 2.58L7 10l5-5 5 5-1.41 1.41L13 8.83V17h-2z"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <div class="vs-note mono" id="vsRosterNote" hidden></div>

          <div class="vs-brief">
            <div class="brief-row">
              <div class="brief-k">Move types <strong>USE</strong></div>
              <div class="brief-v" id="vsBringMoves"></div>
            </div>
            <div class="brief-row">
              <div class="brief-k">Move types <strong>DO NOT USE</strong></div>
              <div class="brief-v" id="vsAvoidMoves"></div>
            </div>
            <div class="brief-row">
              <div class="brief-k">Pok&eacute;mon types <strong>BRING</strong></div>
              <div class="brief-v" id="vsBringBodies"></div>
            </div>
            <div class="brief-row">
              <div class="brief-k">Pok&eacute;mon types <strong>DO NOT BRING</strong></div>
              <div class="brief-v" id="vsAvoidBodies"></div>
            </div>
          </div>

        </div>
      </div>
    </section>
  </div>

      <!-- VIEW: COLLECTION -->
      <div id="viewCollection" hidden>
        <!-- Collection summary bar -->
        <div aria-label="Collection summary" class="collectionbar" id="collectionBar">
          <div class="collection-left">
            <div class="collection-stat">Pokemon: <strong id="collectionCount">-</strong></div>
            <div class="collection-stat">Type coverage: <strong id="collectionCoverage">-/18</strong></div>
          </div>
          <div class="collection-note" title="Updates after CSV upload">Collection</div>
        </div>

        <!-- Filters -->
        <div aria-label="Filters" class="filterzone" id="filterZone">
          <div aria-label="Active filters" class="active-strip">
            <div class="active-left">
              <button aria-controls="typesSheet" aria-haspopup="dialog" class="types-open-btn" id="typesOpenBtn" type="button">
                <span aria-hidden="true" class="types-open-icon">+</span>
                <span>Types</span>
              </button>
              <div aria-label="Selected types" class="active-icons" id="activeIcons">
                <span class="active-all" id="activeAll">All types</span>
              </div>
            </div>
            <button class="clear-btn" hidden="" id="clearBtn" type="button">Clear</button>
          </div>
        </div>

        <section class="collection-view">
          <div class="showing-row">
            <div>Showing: <strong id="showingTypes">Water</strong> <span class="mono" id="showingCount">(-)</span></div>
          </div>
          <div id="parseError" class="error-panel" hidden></div>
          <details id="csvDebug" class="debug-details" hidden>
            <summary>
              <span>CSV detected</span>
              <span id="csvDebugSummary" class="mono"></span>
            </summary>
            <div class="debug-body">
              <div class="debug-block">
                <div class="debug-label">Headers</div>
                <div id="csvHeaders" class="debug-chipwrap"></div>
              </div>
              <div class="debug-block">
                <div class="debug-label">Mapping (what we used)</div>
                <div id="csvMapping" class="debug-mapping"></div>
              </div>
              <div class="debug-block">
                <div class="debug-label">Sample row (first row)</div>
                <div id="csvSample" class="debug-sample"></div>
              </div>
            </div>
          </details>
          <p class="hint">Option C layout: type filters stay pinned, results live directly beneath.</p>
          <section aria-label="Results" class="panel">
            <div class="panel-header">
              <h2>Results</h2>
              <div class="sub">Tap a type pill to filter</div>
            </div>
            <div id="resultsScroll" class="table-wrap">
              <table id="resultsTable">
                <thead>
                  <tr>
                    <th class="sortable" data-key="name"><span class="th-inner">Pokemon <span class="sort-ind" aria-hidden="true"></span></span></th>
                    <th class="mono sortable" data-key="score"><span class="th-inner">Score <span class="sort-ind" aria-hidden="true"></span></span></th>
                    <th class="sortable" data-key="grade"><span class="th-inner">Grade <span class="sort-ind" aria-hidden="true"></span></span></th>
                    <th class="mono sortable" data-key="cp"><span class="th-inner">CP <span class="sort-ind" aria-hidden="true"></span></span></th>
                    <th class="mono sortable" data-key="iv"><span class="th-inner">IV% <span class="sort-ind" aria-hidden="true"></span></span></th>
                    <th class="sortable" data-key="types"><span class="th-inner">Types <span class="sort-ind" aria-hidden="true"></span></span></th>
                  </tr>
                </thead>
                <tbody id="resultsBody">
                  <!-- rows rendered by JS -->
                </tbody>
              </table>
            </div>
          </section>
        </section>
      </div>

      <!-- VIEW: TRADE -->
      <div id="viewTrade" hidden>
        <section id="tradeView" class="trade-view">
          <div class="vs-panel">
            <div class="vs-panel-header">
              <div class="vs-panel-title">Trade</div>
              <div class="panel-subtitle mono">Coming soon. This tab will help you pick safe trades, prioritize distance/lucky odds, and export lists.</div>
            </div>
            <div class="vs-block">
              <div class="hint">Placeholder screen. No behavior yet.</div>
            </div>
          </div>
        </section>
      </div>
    </div><!-- /.window-content -->
  </div><!-- /.app-window -->
</main>

<!-- Type Picker Sheet (Collection mode) -->
<div class="sheet-backdrop" hidden="" id="sheetBackdrop"></div>
<section aria-label="Choose types" aria-modal="true" class="sheet" hidden="" id="typesSheet" role="dialog">
  <div class="sheet-header">
    <div class="sheet-title">Choose types</div>
    <div class="sheet-actions">
      <button class="sheet-btn ghost" id="selectAllBtn" type="button">All</button>
      <button class="sheet-btn ghost" id="sheetClearBtn" type="button">Clear</button>
      <button class="sheet-btn" id="sheetDoneBtn" type="button">Done</button>
    </div>
  </div>
  <div class="sheet-body">
    <div aria-label="Type grid" class="type-grid" id="typeGrid"></div>
    <div class="sheet-hint mono">Tap types to toggle. Selected types show as icons above.</div>
  </div>
</section>

<div id="drawerBackdrop" class="drawer-backdrop" hidden></div>

<aside id="infoDrawer" class="drawer" aria-hidden="true" aria-label="Glossary drawer">
  <div class="drawer-header">
    <div class="drawer-title">Glossary</div>
    <button id="drawerCloseBtn" class="icon-btn" aria-label="Close glossary" title="Close">
      <span aria-hidden="true" class="close-x">X</span>
    </button>
  </div>

  <div class="drawer-content">
    <div class="gloss">
      This panel is intentionally practical: it describes what this prototype is calculating <em>right now</em>, plus the assumptions behind it.
    </div>

    <details open>
      <summary>Score</summary>
      <div class="gloss">
        <strong>Current definition (prototype):</strong> <code>Score = IV%</code>.
        This is a "good enough" stand-in so sorting and filtering are meaningful while we build.
      </div>
    </details>

    <details open>
      <summary>IV%</summary>
      <div class="gloss">
        <strong>IV%</strong> is the Pokemon's individual values (IVs) normalized to a percentage:
        <br/><br/>
        <code>IV% = ((AtkIV + DefIV + StaIV) / 45) x 100</code>
        <br/><br/>
        Each IV ranges 0-15, so the max total is 45.
      </div>
    </details>

    <details open>
      <summary>Grade</summary>
      <div class="gloss">
        A quick letter grade derived from Score/IV%. Thresholds are adjustable; these are the current defaults:
        <div class="grade-grid" aria-label="Grade thresholds">
          <div><span class="grade-pill">S</span> Excellent</div><div>>= 98%</div>
          <div><span class="grade-pill">A</span> Great</div><div>>= 90%</div>
          <div><span class="grade-pill">B</span> Solid</div><div>>= 80%</div>
          <div><span class="grade-pill">C</span> OK</div><div>>= 65%</div>
          <div><span class="grade-pill">D</span> Meh</div><div>>= 50%</div>
          <div><span class="grade-pill">F</span> Low</div><div>< 50%</div>
        </div>
      </div>
    </details>

    <details>
      <summary>Type coverage</summary>
      <div class="gloss">
        <strong>Collection type coverage</strong> counts how many of the 18 Pokemon types appear anywhere in your uploaded collection.
        <br/><br/>
        <code>(unique types found in collection) / 18</code>
      </div>
    </details>
  </div>
</aside>

<!-- VS Info Modal -->
<div id="vsModalBackdrop" class="modal-backdrop" hidden></div>
<div id="vsModal" class="modal" hidden aria-modal="true" role="dialog" aria-label="Battle tips">
  <div class="modal-card">
    <div class="modal-header">
      <div class="modal-title">Battle Tips</div>
      <button id="vsModalClose" class="modal-close-btn" type="button" aria-label="Close">X</button>
    </div>
    <div class="modal-body">
      <div class="t"><strong>When battling, moves matter most.</strong> Damage comes from a Pokémon's <em>move</em> type, not the <em>Pokémon's</em> type.</div>
      <div class="t">Pokémon usually learn moves matching their own type, so bringing a Fire-type against Grass usually means you'll have the right moves to do the most damage.</div>
      <div class="t">That said, CP matters too: a high-CP Pokémon with the "wrong" type will often beat a low-CP Pokémon with the "right" type.</div>
    </div>
  </div>
</div>

</div>

<script type="module" src="./src/app.js"></script>
</body>
</html>
