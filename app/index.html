<!DOCTYPE html>
<!-- v3-refactor: Cloudflare Pages deployment trigger -->
<html lang="en" data-skin="gba-ds">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport"/>
<title>PoGO Pal</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
<link rel="stylesheet" href="./styles/app.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" defer></script>
</head>
<body>

<div class="app">
<!-- APP BAR -->
<header id="appBar" class="appbar">
  <div class="appbar-left">
    <div class="title">PoGO Pal</div>
  </div>
  <div class="appbar-right">
    <input accept=".csv" class="hidden-file" id="fileInput" type="file"/>
    <button id="uploadBtn" class="icon-btn" type="button" aria-label="Upload CSV" title="Upload CSV">
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M19 15v4H5v-4H3v6h18v-6h-2zM11 17V8.83l-2.59 2.58L7 10l5-5 5 5-1.41 1.41L13 8.83V17h-2z"></path>
      </svg>
    </button>
    <!-- Info button hidden for now -->
    <button id="infoBtn" class="icon-btn gbp-q" type="button" aria-label="Info" title="Glossary" hidden>?</button>
  </div>
</header>

<main class="main">
  <div class="app-window">
    <!-- Window Tabs -->
    <div class="window-tabs" role="tablist" aria-label="Mode">
      <button id="modeVsBtn" class="window-tab is-active" role="tab" aria-selected="true" type="button">Versus</button>
      <button id="modeCollectionBtn" class="window-tab" role="tab" aria-selected="false" type="button">Collection</button>
      <button id="modeTradeBtn" class="window-tab" role="tab" aria-selected="false" type="button">Trade</button>
    </div>

    <!-- Window Content -->
    <div class="window-content">
      <!-- VIEW: VERSUS -->
      <div id="viewVersus">
    <section id="vsView" class="vs-view">
      <div class="vs-panel">
        <div class="vs-panel-header">
          <div class="panel-subtitle mono" id="vsSub">
            Choose opponent POKéMON TYPE(S) to get battle recommendations.
            <button class="info-icon-btn" id="vsInfoBtn" type="button" aria-label="More info">i</button>
          </div>
        </div>

        <div class="vs-block">
          <div class="battle-selected-wrap" aria-label="Selected opponent types">
            <div class="battle-selected" id="vsSelected"></div>
          </div>

          <details class="vs-details" id="vsTypePicker" open>
            <summary class="vs-summary" hidden></summary>
            <div class="type-grid" id="vsTypeGrid" aria-label="Opponent type grid"></div>
          </details>

          <div class="action-row">
            <button class="sheet-btn ghost" id="vsClearBtn" type="button">Clear</button>
            <button class="sheet-btn" id="vsDoneBtn" type="button">Done</button>
          </div>
        </div>

        <!-- All recommendations - hidden until opponent types selected -->
        <div id="vsRecommendations" hidden>
          <!-- SECTION 1: Type Effectiveness Recommendations -->
          <div class="collapsible-section" id="vsTypesSection">
            <div class="panel-section-header" id="vsRecoHeader">
              <div class="collapsible-header">
                <div class="panel-subtitle mono">Your POGO PAL recommends these MOVE TYPES and POKéMON TYPES.</div>
                <button class="collapsible-toggle" type="button" aria-label="Toggle section" aria-expanded="true">−</button>
              </div>
            </div>
            <div class="collapsible-content">
              <div class="vs-brief">
                <div class="brief-row">
                  <div class="brief-k">MOVE TYPES <strong>USE</strong></div>
                  <div class="brief-v" id="vsBringMoves"></div>
                </div>
                <div class="brief-row">
                  <div class="brief-k">MOVE TYPES <strong>DO NOT USE</strong></div>
                  <div class="brief-v" id="vsAvoidMoves"></div>
                </div>
                <div class="brief-row">
                  <div class="brief-k">POKéMON TYPES <strong>BRING</strong></div>
                  <div class="brief-v" id="vsBringBodies"></div>
                </div>
                <div class="brief-row">
                  <div class="brief-k">POKéMON TYPES <strong>DO NOT BRING</strong></div>
                  <div class="brief-v" id="vsAvoidBodies"></div>
                </div>
              </div>
            </div>
            <div class="collapsible-placeholder mono">...</div>
          </div>

          <!-- SECTION 2: Pokémon Recommendations -->
          <div class="collapsible-section" id="vsPokeSection">
            <div class="panel-section-header">
              <div class="collapsible-header">
                <div class="panel-subtitle mono">Your POGO PAL's POKéMON recommendations.</div>
                <button class="collapsible-toggle" type="button" aria-label="Toggle section" aria-expanded="true">−</button>
              </div>
            </div>
            <div class="collapsible-content">
              <!-- Section 2 Results (shown when CSV uploaded) -->
              <div class="vs-brief" id="vsPokeRecoResults" hidden>
                <div class="brief-row">
                  <div class="brief-k">POKéMON <strong>BRING</strong></div>
                  <div class="picks-list" id="vsTopPicks"></div>
                </div>
                <div class="brief-row">
                  <div class="brief-k">POKéMON <strong>DON'T BRING</strong></div>
                  <div class="picks-list" id="vsRiskyPicks"></div>
                </div>
                <div class="vs-note mono" id="vsRosterNote" hidden></div>
              </div>

              <!-- Section 2 Empty State: No CSV -->
              <div class="vs-empty" id="vsUploadPrompt">
                <span class="mono">Upload a CSV</span>
                <button class="icon-btn vs-empty-upload" id="vsUploadPromptBtn" type="button" aria-label="Upload CSV" title="Upload CSV">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M19 15v4H5v-4H3v6h18v-6h-2zM11 17V8.83l-2.59 2.58L7 10l5-5 5 5-1.41 1.41L13 8.83V17h-2z"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="collapsible-placeholder mono">...</div>
          </div>
        </div>
      </div>
    </section>
  </div>

      <!-- VIEW: COLLECTION -->
      <div id="viewCollection" hidden>
        <section class="coming-soon-placeholder">
          <div class="vs-panel">
            <div class="vs-panel-header">
              <div class="panel-subtitle mono">Coming soon. This tab will help you organize your POKéMON collection.</div>
            </div>
            <div class="vs-block">
              <div class="collapsible-placeholder mono">...</div>
            </div>
          </div>
        </section>
      </div>

      <!-- VIEW: TRADE -->
      <div id="viewTrade" hidden>
        <section class="coming-soon-placeholder">
          <div class="vs-panel">
            <div class="vs-panel-header">
              <div class="panel-subtitle mono">Coming soon. This tab will help you know what POKéMON to trade and transfer.</div>
            </div>
            <div class="vs-block">
              <div class="collapsible-placeholder mono">...</div>
            </div>
          </div>
        </section>
      </div>
    </div><!-- /.window-content -->
  </div><!-- /.app-window -->
</main>

<!-- Type Picker Sheet (Collection mode) -->
<div class="sheet-backdrop" hidden="" id="sheetBackdrop"></div>
<section aria-label="Choose types" aria-modal="true" class="sheet" hidden="" id="typesSheet" role="dialog">
  <div class="sheet-header">
    <div class="sheet-title">Choose types</div>
    <div class="sheet-actions">
      <button class="sheet-btn ghost" id="selectAllBtn" type="button">All</button>
      <button class="sheet-btn ghost" id="sheetClearBtn" type="button">Clear</button>
      <button class="sheet-btn" id="sheetDoneBtn" type="button">Done</button>
    </div>
  </div>
  <div class="sheet-body">
    <div aria-label="Type grid" class="type-grid" id="typeGrid"></div>
    <div class="sheet-hint mono">Tap types to toggle. Selected types show as icons above.</div>
  </div>
</section>

<div id="drawerBackdrop" class="drawer-backdrop" hidden></div>

<aside id="infoDrawer" class="drawer" aria-hidden="true" aria-label="Glossary drawer">
  <div class="drawer-header">
    <div class="drawer-title">Glossary</div>
    <button id="drawerCloseBtn" class="icon-btn" aria-label="Close glossary" title="Close">
      <span aria-hidden="true" class="close-x">X</span>
    </button>
  </div>

  <div class="drawer-content">
    <div class="gloss">
      This panel is intentionally practical: it describes what this prototype is calculating <em>right now</em>, plus the assumptions behind it.
    </div>

    <details open>
      <summary>Score</summary>
      <div class="gloss">
        <strong>Current definition (prototype):</strong> <code>Score = IV%</code>.
        This is a "good enough" stand-in so sorting and filtering are meaningful while we build.
      </div>
    </details>

    <details open>
      <summary>IV%</summary>
      <div class="gloss">
        <strong>IV%</strong> is the Pokemon's individual values (IVs) normalized to a percentage:
        <br/><br/>
        <code>IV% = ((AtkIV + DefIV + StaIV) / 45) x 100</code>
        <br/><br/>
        Each IV ranges 0-15, so the max total is 45.
      </div>
    </details>

    <details open>
      <summary>Grade</summary>
      <div class="gloss">
        A quick letter grade derived from Score/IV%. Thresholds are adjustable; these are the current defaults:
        <div class="grade-grid" aria-label="Grade thresholds">
          <div><span class="grade-pill">S</span> Excellent</div><div>>= 98%</div>
          <div><span class="grade-pill">A</span> Great</div><div>>= 90%</div>
          <div><span class="grade-pill">B</span> Solid</div><div>>= 80%</div>
          <div><span class="grade-pill">C</span> OK</div><div>>= 65%</div>
          <div><span class="grade-pill">D</span> Meh</div><div>>= 50%</div>
          <div><span class="grade-pill">F</span> Low</div><div>< 50%</div>
        </div>
      </div>
    </details>

    <details>
      <summary>Type coverage</summary>
      <div class="gloss">
        <strong>Collection type coverage</strong> counts how many of the 18 Pokemon types appear anywhere in your uploaded collection.
        <br/><br/>
        <code>(unique types found in collection) / 18</code>
      </div>
    </details>
  </div>
</aside>

<!-- VS Info Modal -->
<div id="vsModalBackdrop" class="modal-backdrop" hidden></div>
<div id="vsModal" class="modal" hidden aria-modal="true" role="dialog" aria-label="Pogo Pal says">
  <div class="modal-card">
    <div class="modal-header">
      <div class="modal-title">POGO PAL SAYS</div>
      <button id="vsModalClose" class="modal-close-btn" type="button" aria-label="Close">X</button>
    </div>
    <div class="modal-body">
      <div class="t"><strong>When battling, moves matter most.</strong> Damage comes from a MOVE TYPE of the POKéMON, not the POKéMON itself.</div>
      <div class="t">POKéMON usually learn moves matching their own TYPE, so bringing a FIRE-TYPE against GRASS-TYPE usually means you'll have the right moves to do the most damage.</div>
      <div class="t">That said, CP matters too: a high-CP POKéMON with the "wrong" MOVE TYPE will often beat a low-CP POKéMON with the "right" MOVE TYPE.</div>
    </div>
  </div>
</div>

</div>

<script type="module" src="./src/app.js"></script>
</body>
</html>
