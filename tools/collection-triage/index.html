<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Collection Triage - PoGO Tools</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="../../shared/sources-modal.css">
</head>
<body>
  <header>
    <a href="../../" class="back-link">&larr; PoGO Tools</a>
    <a href="../../feedback/" class="feedback-link">Give Feedback</a>
  </header>

  <main>
    <section class="intro">
      <h1>Collection Triage</h1>
      <p class="subtitle">Find out which Pokemon to keep, trade, or transfer</p>

      <div class="info-box">
        <h3>What this tool does:</h3>
        <ol>
          <li>Upload your collection (from Poke Genie or Calcy IV)</li>
          <li>We find duplicates and low-IV Pokemon you can safely transfer</li>
          <li>We identify your best raiders and PvP Pokemon</li>
          <li>You get a short list of what to get rid of (not 90% of your collection!)</li>
        </ol>
        <p class="privacy-inline">
          Your data never leaves your browser. We can't see your Pokemon.
        </p>
      </div>
    </section>

    <section class="upload-section">
      <div class="upload-zone" id="uploadZone">
        <p class="upload-icon">üìÅ</p>
        <p class="upload-text">Drag CSV here or click to browse</p>
        <p class="upload-formats">Supports: Poke Genie, Calcy IV</p>
        <input type="file" id="fileInput" accept=".csv" hidden>
      </div>
      <div class="status" id="status">No file loaded</div>
    </section>

    <section class="results-section" id="resultsSection" hidden>
      <div class="summary-cards" id="summaryCards">
        <div class="summary-card card-transfer" data-filter="SAFE_TRANSFER">
          <div class="card-number" id="countTransfer">0</div>
          <div class="card-label">Safe to Transfer</div>
        </div>
        <div class="summary-card card-trade" data-filter="TRADE_CANDIDATE">
          <div class="card-number" id="countTrade">0</div>
          <div class="card-label">Trade Candidates</div>
        </div>
        <div class="summary-card card-raider" data-filter="TOP_RAIDER">
          <div class="card-number" id="countRaider">0</div>
          <div class="card-label">Top Raiders</div>
        </div>
        <div class="summary-card card-pvp" data-filter="TOP_PVP">
          <div class="card-number" id="countPvp">0</div>
          <div class="card-label">Top PvP</div>
        </div>
      </div>

      <div class="summary-secondary">
        <span id="countKeep">0</span> Pokemon are fine to keep (not shown by default)
      </div>

      <div class="triage-options">
        <div class="mode-toggle">
          <span class="mode-label">Mode:</span>
          <div class="mode-buttons">
            <button type="button" class="mode-btn active" id="modeCasual" data-mode="casual">
              Casual
            </button>
            <button type="button" class="mode-btn" id="modeOptimization" data-mode="optimization">
              Optimization
            </button>
          </div>
          <span class="mode-hint" id="modeHint">Simple storage cleanup - keep highest IV% per species</span>
        </div>

        <div class="toggle-row">
          <label class="toggle-label">
            <input type="checkbox" id="tradeToggle">
            <span class="toggle-text">I have a trade partner</span>
            <span class="toggle-hint">Duplicates become trade candidates</span>
          </label>
        </div>
      </div>

      <div class="actions">
        <button id="downloadChecklist" class="primary">Download Action Checklist</button>
        <button id="downloadJson">Download Full Results (JSON)</button>
      </div>

      <div class="filters" id="filters">
        <select id="filterVerdict">
          <option value="SAFE_TRANSFER">Safe to Transfer</option>
          <option value="TRADE_CANDIDATE">Trade Candidates</option>
          <option value="TOP_RAIDER">Top Raiders</option>
          <option value="TOP_PVP">Top PvP</option>
          <option value="all">All Pokemon</option>
          <option value="KEEP">Just "Keep" (no action needed)</option>
        </select>
        <input type="text" id="searchInput" placeholder="Search by name...">
        <span class="results-count" id="resultsCount"></span>
      </div>

      <div class="results-table-container">
        <table class="results-table" id="resultsTable">
          <thead>
            <tr>
              <th class="sortable" data-sort="name">Pokemon<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort="cp">CP<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort="ivPercent">IVs<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort="verdict">Verdict<span class="sort-indicator"></span></th>
              <th>Why?</th>
            </tr>
          </thead>
          <tbody id="resultsBody">
            <!-- Populated by JS -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <p>
      <span class="sources-placeholder"></span> ¬∑
      <a href="../../feedback/">Feedback</a> ¬∑
      <a href="https://github.com/david-steinbroner/pogo-tools">GitHub</a>
    </p>
    <p class="privacy-note">
      Your data never leaves your browser. We can't see your Pokemon.
    </p>
  </footer>

  <!-- Details Modal -->
  <div class="details-modal-overlay" id="detailsModal" hidden>
    <div class="details-modal">
      <h3 id="detailsTitle">Pokemon Details</h3>
      <p id="detailsContent"></p>
      <button onclick="hideDetails()">Close</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../csv-to-json/vendor/papaparse.min.js"></script>
  <script src="../../shared/pokemon-parser.js"></script>
  <script src="../../shared/pokemon-triage.js"></script>
  <script src="../../shared/sources-modal.js"></script>
  <script src="app.js"></script>
</body>
</html>
